+++
title = "Настройка безопасности для сервера SSH"
description = "Как настроить сервер SSH чтобы он был безопасным."
date = 2020-11-13
updated = 2020-11-13

[taxonomies]
tags = ["software", "security", "ssh"]
categories = ["software", "linux", "security"]
+++

SSH (Secure Shell) - это протокол прикладного уровня с шифрованием трафика. Самый распространённый протокол 
удалённого доступа к Linux\Unix-серверам. Самая популярная реализация серверной части это OpenSSH.

Тем не менее, даже самую безопасную систему на свете можно сделать уязвимой благодаря настройке. Во многих дистрибутивах
служба SSH имеет уязвимую конфигурацию.

Две главных уязвимости:

1. Разрешён удалённый доступ пользователю `root`;
2. Не указан список пользователей, которым разрешён доступ.

В некоторых дистрибутивах встречаются опция - разрешён вход для пользователей с пустыми паролями.

В этой статье настроим две конфигурации:

1. Минимально-рекомендуемая
   Данный уровень безопасности позволит отразить 99% атак на SSH-сервер.
   
2. Усиленная


## Настройка минимально рекомендуемой конфигурации

```bash
# Запрещаем вход пользователю root через удалённый доступ
PermitRootLogin no

# Разрешаем подключение только для указанных пользователей
AllowUsers user1 user2 user3

# Меняем порт на нестандартный
Port 14819

# Запрещаем вход пользователям с пустыми паролями
PermitEmptyPasswords no

# Отключаем неиспользуемые способы аутентификации
KerberosAuthentication no
GSSAPIAuthentication no

# Отключаем возможность доступа к графическим приложениям
X11Forwarding no

# Отключаем возможности туннелирования, использования сервера в качестве промежуточного узла
AllowAgentForwarding no
AllowTcpForwarding no
PermitTunnel no
```

## Настройка усиленной безопасности

Помимо минимально рекомендуемых настроек, можно запретить доступ к порту сервиса и отключить вход по логину и паролю. 

### Блокируем доступ к порту SSH для доверенных IP

Например, с помощью firewalld:

```shell script
firewall-cmd --permanent --zone=public --remote-service=ssh
firewall-cmd --permanent --zone=trusted --add-service=ssh
firewall-cmd --reload
```

### Включаем вход по ключам и отключаем доступ по логину и паролю

```bash
PasswordAuthentication no
```

## Проверка и применение настроек

Проверяем что настройки корректные:

```shell script
sshd -t
```
Если демон не написал ошибок, значит всё хорошо.

Перезапускаем службу:

```
systemctl restart sshd
```
