<?xml version="1.0" encoding="UTF-8"?>
<rss xmlns:atom="http://www.w3.org/2005/Atom"

     xmlns:yandex="http://news.yandex.ru"
     xmlns:turbo="http://turbo.yandex.ru"

     version="2.0">
    <channel>
        <title>TinyOps :: Блог</title>
        <link>https:&#x2F;&#x2F;b.tinyops.ru</link>
        <description>О технологиях, подходах и решении проблем простым языком</description>
        <generator>Zola</generator>
        <language>ru</language>
        <atom:link href="https:&#x2F;&#x2F;b.tinyops.ru/rss.xml" rel="self" type="application/rss+xml"/>
        <lastBuildDate>2020-04-09</lastBuildDate>

        
        <turbo:analytics type="Yandex"
                         id="56992924"
                         params="{}"></turbo:analytics>
        

        
        <item
            
                turbo="true"
            
            >
            <title>Настройка Nginx для проксирования Web-сокетов</title>
            <pubDate>2020-04-09</pubDate>
            <link>https:&#x2F;&#x2F;b.tinyops.ru/nginx-websocket-proxy</link>
            <guid>https:&#x2F;&#x2F;b.tinyops.ru/nginx-websocket-proxy</guid>
            <description>Как настроить проксирование Web-сокетов с помощью Nginx.</description>
            
                <turbo:source></turbo:source>
                <turbo:topic></turbo:topic>
                <metrics>
                    <yandex schema_identifier="56992924">
                        <breadcrumblist>
                            <breadcrumb url="https:&#x2F;&#x2F;b.tinyops.ru/" text="Главная"/>

                            
                            <breadcrumb url="https:&#x2F;&#x2F;b.tinyops.ru/categories/tutorial" text="Категория tutorial"/>
                            

                            
                                <breadcrumb url="https:&#x2F;&#x2F;b.tinyops.ru/tags/nginx" text="Тэг nginx"/>
                            
                                <breadcrumb url="https:&#x2F;&#x2F;b.tinyops.ru/tags/web-sockets" text="Тэг web-sockets"/>
                            

                            <breadcrumb url="https:&#x2F;&#x2F;b.tinyops.ru/nginx-websocket-proxy" text="Настройка Nginx для проксирования Web-сокетов"/>
                        </breadcrumblist>
                    </yandex>
                </metrics>
                <yandex:related></yandex:related>
                <turbo:content>
                    &lt;p&gt;Nginx легко настроить для проксирования Web-сокетов, эта функциональность поддерживается с версии 1.3. Для переключения
HTTP запросов в Web-сокеты используется 
механизм &lt;a href=&quot;https:&#x2F;&#x2F;tools.ietf.org&#x2F;html&#x2F;rfc2616#section-14.42&quot;&gt;смены протокола&lt;&#x2F;a&gt; доступный в HTTP&#x2F;1.1. 
Передаются два заголовка: Connection и Upgrade.&lt;&#x2F;p&gt;
&lt;p&gt;Например, ваше приложение слушает tcp-порт &lt;code&gt;12345&lt;&#x2F;code&gt; и поддерживает Web-сокеты, вот как это настраивается:&lt;&#x2F;p&gt;
&lt;pre style=&quot;background-color:#2b303b;&quot;&gt;
&lt;span style=&quot;color:#c0c5ce;&quot;&gt;location &#x2F; {
    proxy_pass http:&#x2F;&#x2F;localhost:12345;
    proxy_http_version 1.1;
    proxy_set_header Upgrade $http_upgrade;
    proxy_set_header Connection &amp;quot;upgrade&amp;quot;;
}
&lt;&#x2F;span&gt;&lt;&#x2F;pre&gt;&lt;h3 id=&quot;kogda-obryvaet-web-sokety&quot;&gt;Когда обрывает Web-сокеты&lt;&#x2F;h3&gt;
&lt;p&gt;Как-то раз на production сервере мы поймали проблему - Web-сокеты обрывались каждые 2 минуты. 
По умолчанию nginx закрывает проксируемые соединения после 60 секунд неактивности. Эта величина регулируется параметром
&lt;a href=&quot;https:&#x2F;&#x2F;nginx.org&#x2F;ru&#x2F;docs&#x2F;http&#x2F;ngx_http_proxy_module.html#proxy_read_timeout&quot;&gt;proxy_read_timeout&lt;&#x2F;a&gt;. На нашем сервере
был настроен &lt;code&gt;proxy_read_timeout&lt;&#x2F;code&gt; равный как раз двум минутам.&lt;&#x2F;p&gt;
&lt;p&gt;Поэтому чтобы Web-сокеты не обрывало приложение должно уметь отправлять условные ping-запросы.&lt;&#x2F;p&gt;
&lt;h3 id=&quot;ofitsial-naia-dokumentatsiia&quot;&gt;Официальная документация&lt;&#x2F;h3&gt;
&lt;p&gt;&lt;a href=&quot;https:&#x2F;&#x2F;nginx.org&#x2F;ru&#x2F;docs&#x2F;http&#x2F;websocket.html&quot;&gt;Проксирование WebSocket&lt;&#x2F;a&gt;&lt;&#x2F;p&gt;

                </turbo:content>
            
        </item>
        
        
    </channel>
</rss>
